{"version":3,"sources":["../src/type.ts","../src/utils.ts","../src/useRouter.ts","../src/useRoute.ts","../src/create.ts","../src/plugin.ts"],"sourcesContent":["import type { PageMetaDatum } from './pages';\r\n\r\nexport enum CloseTypes {\r\n    default = 'default',\r\n    current = 'current',\r\n    all = 'all',\r\n}\r\n\r\nexport interface RouteMeta extends PageMetaDatum {\r\n    /** é¡µé¢å¯¹åº”çš„çœŸå®è·¯å¾„ï¼Œä¾‹å¦‚ï¼špages/home/index */\r\n    url: string\r\n    /** æ˜¯å¦ä¸º tabBar é¡µé¢ */\r\n    isTabBar?: boolean\r\n    /**\r\n     * é¡µé¢å”¯ä¸€key\r\n     */\r\n    name: string\r\n}\r\n\r\nexport interface RouterParams<TPath extends string> {\r\n    /** è·¯ç”±åç§°ï¼ˆæ¥è‡ª createRouter æ³¨å†Œçš„ç±»å‹ï¼‰ */\r\n    path?: TPath\r\n    /** éœ€è¦ä¼ é€’ç»™ç›®æ ‡é¡µé¢çš„æŸ¥è¯¢å‚æ•° */\r\n    query?: Record<string, any>\r\n    /** é¡µé¢å…³é—­ç­–ç•¥ */\r\n    close?: CloseTypes | keyof typeof CloseTypes\r\n    /** æˆåŠŸå›è°ƒï¼Œå¯ä»¥æ¥æ”¶ handler çš„è¿”å›å€¼ */\r\n    success?: (result?: unknown) => void\r\n    /** å¤±è´¥å›è°ƒ */\r\n    fail?: (error?: any) => void\r\n}\r\n\r\n/** ç±»å‹å®‰å…¨çš„è·¯ç”±æ¨é€å‡½æ•°ç±»å‹ */\r\nexport type TypeSafePush<TPath extends string> = (\r\n    data: TPath | RouterParams<TPath>,\r\n    callbacks?: {\r\n        success?: (result?: unknown) => void\r\n        fail?: (error?: any) => void\r\n    }\r\n) => Promise<void>\r\n\r\n/**\r\n * é¡µé¢å…³é—­ç­–ç•¥è¾“å…¥ç±»å‹\r\n */\r\nexport type CloseInput = CloseTypes | keyof typeof CloseTypes | undefined;\r\n\r\n\r\n","import { PagesConfig } from \"./pages\";\r\nimport { CloseInput, CloseTypes, RouteMeta } from \"./type\";\r\n\r\n/**\r\n * æå–URLè·¯å¾„çš„ç¬¬äºŒæ®µæˆ–è€…å°†å¤šæ®µè·¯å¾„ç”¨ä¸‹åˆ’çº¿è¿æ¥\r\n * @param url éœ€è¦å¤„ç†çš„URL\r\n * @returns å¤„ç†åçš„å­—ç¬¦ä¸²\r\n */\r\nexport function extractSecondPathSegment(url: string): string {\r\n\tconst segments = url.split(\"/\").slice(1, -1);\r\n\treturn segments.length === 1 ? segments[0] : segments.join(\"_\");\r\n}\r\n\r\nconst isEnumValue = <T extends Record<string, string>>(enumObject: T, value: unknown): value is T[keyof T] =>\r\n\tObject.values(enumObject).includes(value as T[keyof T]);\r\n\r\nexport const ensureLeadingSlash = (url: string): string => (url.startsWith(\"/\") ? url : `/${url}`);\r\n\r\nexport const buildUrlWithQuery = (url: string, query: Record<string, any>): string => {\r\n\tconst normalized = ensureLeadingSlash(url);\r\n\tconst queryEntries = Object.entries(query ?? {}).filter(([, value]) => value !== undefined);\r\n\tif (queryEntries.length === 0) {\r\n\t\treturn normalized;\r\n\t}\r\n\r\n\tconst queryString = queryEntries\r\n\t\t.map(([key, value]) => {\r\n\t\t\tconst serialized = typeof value === \"object\" && value !== null ? JSON.stringify(value) : String(value);\r\n\t\t\treturn `${encodeURIComponent(key)}=${encodeURIComponent(serialized)}`;\r\n\t\t})\r\n\t\t.join(\"&\");\r\n\r\n\treturn `${normalized}?${queryString}`;\r\n};\r\nexport const resolveCloseType = (close: CloseInput): CloseTypes => {\r\n\tif (!close) return CloseTypes.default;\r\n\tif (isEnumValue(CloseTypes, close)) return close;\r\n\tif (typeof close === \"string\" && close in CloseTypes) return CloseTypes[close as keyof typeof CloseTypes];\r\n\treturn CloseTypes.default;\r\n};\r\n\r\n/**\r\n * ä» pages.json è§£æè·¯ç”±ä¿¡æ¯\r\n * @param routes - pages.json é…ç½®å¯¹è±¡\r\n * @returns è·¯ç”±å…ƒä¿¡æ¯æ˜ å°„\r\n */\r\nexport function parseRoutesFromPagesJson<TName extends string>(routes: PagesConfig) {\r\n\tconst routeMeta = new Map<TName, RouteMeta>();\r\n\t// è·å– TabBar é¡µé¢è·¯å¾„é›†åˆ\r\n\tconst tabBarPaths = new Set<string>();\r\n\tif (routes.tabBar?.list) {\r\n\t\troutes.tabBar.list.forEach(item => {\r\n\t\t\ttabBarPaths.add(item.pagePath);\r\n\t\t});\r\n\t}\r\n\r\n\t// å¤„ç†ä¸»åŒ…é¡µé¢\r\n\tif (routes.pages) {\r\n\t\troutes.pages.forEach(page => {\r\n\t\t\tconst name = extractSecondPathSegment(page.path) as TName;\r\n\t\t\tif (name) {\r\n\t\t\t\trouteMeta.set(name, {\r\n\t\t\t\t\t...page,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tisTabBar: tabBarPaths.has(page.path) || page.type === \"tabBar\",\r\n\t\t\t\t\turl: page.path,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tif (routes.subPackages) {\r\n\t\t// å¤„ç†åˆ†åŒ…é¡µé¢\r\n\t\tconst subpackages = routes.subPackages;\r\n\t\tsubpackages.forEach(subpackage => {\r\n\t\t\tconst root = subpackage.root;\r\n\t\t\tsubpackage.pages.forEach(page => {\r\n\t\t\t\tconst fullPath = `${root}/${page.path}`;\r\n\t\t\t\tconst name = extractSecondPathSegment(fullPath);\r\n\t\t\t\tif (name) {\r\n\t\t\t\t\troutes.set(name, {\r\n\t\t\t\t\t\t...page,\r\n\t\t\t\t\t\tname,\r\n\t\t\t\t\t\tisTabBar: tabBarPaths.has(fullPath) || page.type === \"tabBar\",\r\n\t\t\t\t\t\turl: fullPath,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\treturn routeMeta;\r\n}\r\n","import type { RouterCore } from './create';\r\nimport type { RouteLocationNormalized, RouteLocationRaw } from './create';\r\nimport { CloseTypes, RouterParams, TypeSafePush } from './type';\r\nimport { ensureLeadingSlash, buildUrlWithQuery, resolveCloseType, extractSecondPathSegment } from './utils';\r\n\r\n\r\nconst performNavigation = async (url: string, close: CloseTypes): Promise<void> => {\r\n\tconst navigationMethods: Record<CloseTypes, (options: UniApp.NavigateToOptions) => Promise<void>> = {\r\n\t\t[CloseTypes.default]: (options) =>\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tsuccess: () => resolve(),\r\n\t\t\t\t\tfail: (err) => reject(err),\r\n\t\t\t\t});\r\n\t\t\t}),\r\n\t\t[CloseTypes.current]: (options) =>\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tsuccess: () => resolve(),\r\n\t\t\t\t\tfail: (err) => reject(err),\r\n\t\t\t\t});\r\n\t\t\t}),\r\n\t\t[CloseTypes.all]: (options) =>\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tsuccess: () => resolve(),\r\n\t\t\t\t\tfail: (err) => reject(err),\r\n\t\t\t\t});\r\n\t\t\t}),\r\n\t};\r\n\r\n\tawait navigationMethods[close]({ url });\r\n};\r\n\r\nexport type RouterHookResult<TPath extends string> = {\r\n\t/** ç±»å‹å®‰å…¨çš„è·¯ç”±è·³è½¬æ–¹æ³• */\r\n\tpush: TypeSafePush<TPath>;\r\n};\r\n\r\n/**\r\n * åˆ›å»ºä¸æŒ‡å®š Router å®ä¾‹ç»‘å®šçš„è·¯ç”±é’©å­ï¼Œé¿å…åœ¨è°ƒç”¨ç«¯é‡å¤ä¼ å‚ã€‚\r\n */\r\nexport function createRouterHook<TName extends string>(router: RouterCore<TName>): RouterHookResult<TName> {\r\n\t/**\r\n\t * è·å–å½“å‰è·¯ç”±åç§°\r\n\t */\r\n\tconst getCurrentRouteName = (): TName | '' => {\r\n\t\tconst currentPage = getCurrentPages().at(-1);\r\n\t\tif (!currentPage?.route) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\treturn (extractSecondPathSegment(currentPage.route) as TName) || '';\r\n\t};\r\n\r\n\t/**\r\n\t * ç»Ÿä¸€çš„è·¯ç”±è·³è½¬å®ç°ï¼šå…ˆè§¦å‘ createRouter æ³¨å†Œçš„æ‹¦æˆªå™¨ä¸å¤„ç†å™¨ï¼Œå†æ‰§è¡Œå®é™…è·³è½¬ã€‚\r\n\t */\r\n\tconst basicPush = async (input: TName | RouterParams<TName>): Promise<void> => {\r\n\t\tconst routeData = typeof input === 'string' ? { path: input } : input;\r\n\t\tconst path = routeData.path;\r\n\t\tif (!path) {\r\n\t\t\tconst error = new Error('è·¯ç”±åç§°ä¸èƒ½ä¸ºç©º');\r\n\t\t\trouteData.fail?.(error);\r\n\t\t\tif (!routeData.fail) throw error;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst meta = router.getRouteMeta(path);\r\n\t\tif (!meta) {\r\n\t\t\tconst error = new Error(`æ‰¾ä¸åˆ°åŒ¹é…çš„è·¯ç”±é…ç½®: ${String(path)}`);\r\n\t\t\trouteData.fail?.(error);\r\n\t\t\tif (!routeData.fail) throw error;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst query = routeData.query ?? {};\r\n\t\tconst closeType = resolveCloseType(routeData.close);\r\n\r\n\t\tconst routePayload = { query, closeType, meta };\r\n\r\n\t\t// è·å–æ¥æºè·¯ç”±ä¿¡æ¯\r\n\t\tconst fromName = getCurrentRouteName();\r\n\t\tconst fromMeta = fromName ? router.getRouteMeta(fromName) : undefined;\r\n\r\n\t\t// åˆ›å»ºæ ‡å‡†åŒ–çš„è·¯ç”±ä½ç½®å¯¹è±¡\r\n\t\tconst to: RouteLocationNormalized<TName> = {\r\n\t\t\tname: path,\r\n\t\t\tmeta,\r\n\t\t\tquery,\r\n\t\t\tpath: meta.url,\r\n\t\t};\r\n\r\n\t\tconst from: RouteLocationNormalized<TName> = {\r\n\t\t\tname: fromName || ('' as TName),\r\n\t\t\tmeta: fromMeta,\r\n\t\t\tquery: {},\r\n\t\t\tpath: fromMeta?.url || '',\r\n\t\t};\r\n\r\n\t\tlet navigationResult: unknown;\r\n\t\tlet redirectTo: RouteLocationRaw<TName> | undefined;\r\n\r\n\t\ttry {\r\n\t\t\t// æ‰§è¡Œ beforeEach å¯¼èˆªå®ˆå«\r\n\t\t\tconst beforeResult = await router.runBeforeInterceptors(to, from);\r\n\r\n\t\t\tif (!beforeResult.shouldContinue) {\r\n\t\t\t\t// å¯¼èˆªè¢«å–æ¶ˆ\r\n\t\t\t\tif (beforeResult.redirectTo) {\r\n\t\t\t\t\t// é‡å®šå‘åˆ°å…¶ä»–è·¯ç”±\r\n\t\t\t\t\tredirectTo = beforeResult.redirectTo;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// å®Œå…¨å–æ¶ˆå¯¼èˆª\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\trouteData.fail?.(error as Error);\r\n\t\t\tif (!routeData.fail) throw error;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// å¦‚æœæœ‰é‡å®šå‘,é€’å½’è°ƒç”¨ push\r\n\t\tif (redirectTo) {\r\n\t\t\tif (typeof redirectTo === 'string') {\r\n\t\t\t\t// ç®€å•çš„è·¯ç”±åç§°é‡å®šå‘\r\n\t\t\t\treturn basicPush(\r\n\t\t\t\t\ttypeof routeData === 'object'\r\n\t\t\t\t\t\t? { ...routeData, path: redirectTo }\r\n\t\t\t\t\t\t: redirectTo\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\t// è·¯ç”±å¯¹è±¡é‡å®šå‘\r\n\t\t\t\treturn basicPush({\r\n\t\t\t\t\t...routeData,\r\n\t\t\t\t\tpath: redirectTo.path,\r\n\t\t\t\t\tquery: redirectTo.query || routeData.query,\r\n\t\t\t\t\t// TODO: å¤„ç† replace é€‰é¡¹\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// æ‰§è¡Œ handler\r\n\t\ttry {\r\n\t\t\tconst handler = router.getHandler(path);\r\n\t\t\tnavigationResult = handler ? await handler(routePayload) : undefined;\r\n\t\t\tawait router.runAfterInterceptors(to, from);\r\n\t\t} catch (error) {\r\n\t\t\trouteData.fail?.(error as Error);\r\n\t\t\tif (!routeData.fail) throw error;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (navigationResult === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// å°† query å’Œ handler è¿”å›å€¼ä¸€èµ·ç¼“å­˜,ä¾›ç›®æ ‡é¡µé¢ä½¿ç”¨\r\n\t\trouter.setPageCache(path, {\r\n\t\t\tquery,\r\n\t\t\thandlerResult: navigationResult,\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tif (meta.isTabBar) {\r\n\t\t\t\tif (Object.keys(query).length > 0) {\r\n\t\t\t\t\tconsole.warn('è·³è½¬ tabBar é¡µé¢æ—¶ä¼šå¿½ç•¥ query å‚æ•°');\r\n\t\t\t\t}\r\n\t\t\t\tawait new Promise<void>((resolve, reject) => {\r\n\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\turl: ensureLeadingSlash(meta.url),\r\n\t\t\t\t\t\tsuccess: () => resolve(),\r\n\t\t\t\t\t\tfail: (err) => reject(err),\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tawait performNavigation(buildUrlWithQuery(meta.url, query), closeType);\r\n\t\t\t}\r\n\r\n\t\t\t// æˆåŠŸå›è°ƒï¼Œä¼ é€’ handler çš„è¿”å›å€¼(ä»…ç”¨äºé€šçŸ¥è·³è½¬æˆåŠŸ)\r\n\t\t\trouteData.success?.(navigationResult);\r\n\t\t} catch (error) {\r\n\t\t\trouter.deletePageCache(path);\r\n\t\t\trouteData.fail?.(error as Error);\r\n\t\t\tif (!routeData.fail) throw error;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * å¯¼å‡ºç»™å¤–éƒ¨ä½¿ç”¨çš„ pushï¼Œæ”¯æŒé¢å¤–å›è°ƒåˆå¹¶ã€‚\r\n\t */\r\n\tconst push: TypeSafePush<TName> = async (data, callbacks) => {\r\n\t\tconst routeData = typeof data === 'string' ? { path: data } : data;\r\n\t\tconst finalRouteData: RouterParams<TName> = {\r\n\t\t\t...routeData,\r\n\t\t\tsuccess: callbacks?.success ?? routeData.success,\r\n\t\t\tfail: callbacks?.fail ?? routeData.fail,\r\n\t\t};\r\n\r\n\t\tawait basicPush(finalRouteData);\r\n\t};\r\n\r\n\treturn {\r\n\t\tpush\r\n\t}\r\n}","import type { RouterCore } from './create';\r\nimport type { RouteMeta } from './type';\r\nimport { extractSecondPathSegment } from './utils';\r\n\r\n/**\r\n * æ‰©å±• uni-app é¡µé¢å®ä¾‹ç±»å‹,åŒ…å« options å±æ€§\r\n */\r\ninterface UniPageInstance extends Page.PageInstance<AnyObject, Record<string, any>> {\r\n\t/** é¡µé¢è·¯ç”±è·¯å¾„ */\r\n\troute?: string;\r\n\t/** é¡µé¢ URL æŸ¥è¯¢å‚æ•° */\r\n\toptions?: Record<string, string>;\r\n}\r\n\r\n/**\r\n * useRoute è¿”å›çš„è·¯ç”±ä¿¡æ¯\r\n */\r\nexport interface RouteInfo<TName extends string> {\r\n\t/** è·¯ç”±åç§° */\r\n\tname: TName;\r\n\t/** è·¯ç”±å…ƒä¿¡æ¯ */\r\n\tmeta?: RouteMeta;\r\n\t/** åˆå¹¶åçš„æŸ¥è¯¢å‚æ•°(åŒ…å« URL å‚æ•°å’Œç¼“å­˜å‚æ•°) */\r\n\tquery: Record<string, any>;\r\n\t/** Handler è¿”å›å€¼ */\r\n\thandlerResult?: unknown;\r\n}\r\n\r\n/**\r\n * åˆ›å»ºè·¯ç”±é’©å­,è·å–å½“å‰é¡µé¢çš„è·¯ç”±ä¿¡æ¯\r\n * @param router - Router æ ¸å¿ƒå®ä¾‹\r\n * @returns å½“å‰é¡µé¢çš„è·¯ç”±ä¿¡æ¯\r\n */\r\nexport function createRouteHook<TName extends string>(router: RouterCore<TName>): RouteInfo<TName> {\r\n\t// è·å–å½“å‰é¡µé¢å®ä¾‹\r\n\tconst pages = getCurrentPages();\r\n\tconst currentPage = pages[pages.length - 1] as UniPageInstance | undefined;\r\n\r\n\t// å¦‚æœæ²¡æœ‰å½“å‰é¡µé¢,è¿”å›ç©ºä¿¡æ¯\r\n\tif (!currentPage?.route) {\r\n\t\tconsole.warn('æ— æ³•è·å–å½“å‰é¡µé¢çš„è·¯ç”±ä¿¡æ¯');\r\n\t\treturn {\r\n\t\t\tname: '' as TName,\r\n\t\t\tmeta: undefined,\r\n\t\t\tquery: {},\r\n\t\t\thandlerResult: undefined,\r\n\t\t};\r\n\t}\r\n\r\n\t// ä»è·¯ç”±è·¯å¾„æå–è·¯ç”±åç§°\r\n\tconst routeName = extractSecondPathSegment(currentPage.route) as TName;\r\n\r\n\t// è·å–è·¯ç”±å…ƒä¿¡æ¯\r\n\tconst meta = router.getRouteMeta(routeName);\r\n\r\n\t// è·å–é¡µé¢ç¼“å­˜æ•°æ®(åŒ…å« query å’Œ handlerResult)\r\n\tconst cache = router.getPageCache(routeName as TName);\r\n\r\n\t// åˆå¹¶æŸ¥è¯¢å‚æ•°: ç¼“å­˜çš„ query + URL ä¸­çš„ options\r\n\tconst mergedQuery: Record<string, any> = {\r\n\t\t...cache?.query,\r\n\t\t...currentPage.options,\r\n\t};\r\n\r\n\treturn {\r\n\t\tname: routeName,\r\n\t\tmeta,\r\n\t\tquery: mergedQuery,\r\n\t\thandlerResult: cache?.handlerResult,\r\n\t};\r\n}","import { createRouterHook, RouterHookResult } from './useRouter';\r\nimport { createRouteHook, RouteInfo } from './useRoute';\r\nimport type { RouteMeta } from './type';\r\nimport { PagesConfig } from './pages';\r\nimport { parseRoutesFromPagesJson } from './utils';\r\n\r\n// å¯¼å‡ºç±»å‹ä¾›å¤–éƒ¨ä½¿ç”¨\r\nexport type { RouteInfo, RouterHookResult, RouteMeta };\r\nexport { CloseTypes, RouterParams } from './type';\r\n\r\ntype RouteHandler = (payload?: unknown) => unknown | Promise<unknown>;\r\n\r\n/**\r\n * æ ‡å‡†åŒ–çš„è·¯ç”±ä½ç½®\r\n */\r\nexport interface RouteLocationNormalized<TName extends string> {\r\n    /** è·¯ç”±åç§° */\r\n    name: TName;\r\n    /** è·¯ç”±å…ƒä¿¡æ¯ */\r\n    meta?: RouteMeta;\r\n    /** æŸ¥è¯¢å‚æ•° */\r\n    query: Record<string, any>;\r\n    /** å®Œæ•´è·¯å¾„ */\r\n    path: string;\r\n}\r\n\r\n/**\r\n * è·¯ç”±åœ°å€(ç”¨äºé‡å®šå‘)\r\n */\r\nexport type RouteLocationRaw<TName extends string> =\r\n    | TName\r\n    | {\r\n        path: TName;\r\n        query?: Record<string, any>;\r\n        replace?: boolean;\r\n    };\r\n\r\n/**\r\n * è·¯ç”±å®ˆå«å‡½æ•°ç±»å‹\r\n * @param to å³å°†è¦è¿›å…¥çš„ç›®æ ‡è·¯ç”±\r\n * @param from å½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„è·¯ç”±\r\n * @returns \r\n *   - false: å–æ¶ˆå½“å‰å¯¼èˆª\r\n *   - RouteLocationRaw: é‡å®šå‘åˆ°ä¸åŒçš„åœ°å€\r\n *   - undefined/true/void: ç»§ç»­å¯¼èˆª\r\n */\r\nexport type NavigationGuard<TName extends string> = (\r\n    to: RouteLocationNormalized<TName>,\r\n    from: RouteLocationNormalized<TName>\r\n) => void | boolean | RouteLocationRaw<TName> | Promise<void | boolean | RouteLocationRaw<TName>>;\r\n\r\n\r\n\r\n/**\r\n * Router æ ¸å¿ƒèƒ½åŠ›ï¼šæ³¨å†Œå¤„ç†å‡½æ•°ä¸æ‹¦æˆªå™¨ï¼Œå¹¶å­˜å‚¨å…ƒä¿¡æ¯ã€‚\r\n */\r\nexport interface RouterCore<TName extends string> {\r\n    /**\r\n     * æ³¨å†Œä¸€ä¸ªè·¯ç”±å¤„ç†å‡½æ•°ã€‚è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…ï¼ˆå¸è½½ï¼‰å‡½æ•°ï¼Œç”¨äºç§»é™¤è¯¥å¤„ç†å‡½æ•°ã€‚\r\n     */\r\n    register(name: TName, handler: RouteHandler): () => void;\r\n    /**\r\n     * é€šè¿‡åç§°ç§»é™¤å·²æ³¨å†Œçš„å¤„ç†å‡½æ•°ã€‚è‹¥å­˜åœ¨åˆ™è¿”å› trueã€‚\r\n     */\r\n    unregister(name: TName): boolean;\r\n    /**\r\n     * æ£€æŸ¥æ˜¯å¦å·²ä¸ºç»™å®šåç§°æ³¨å†Œå¤„ç†å‡½æ•°ã€‚\r\n     */\r\n    has(name: TName): boolean;\r\n    /**\r\n     * è·å–æŒ‡å®šè·¯ç”±åç§°å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚\r\n     */\r\n    getHandler(name: TName): RouteHandler | undefined;\r\n    /**\r\n     * æ·»åŠ ä¸€ä¸ª beforeEach å¯¼èˆªå®ˆå«ã€‚è¿”å›ä¸€ä¸ªå¸è½½è¯¥å®ˆå«çš„å‡½æ•°ã€‚\r\n     */\r\n    beforeEach(guard: NavigationGuard<TName>): () => void;\r\n    /**\r\n     * æ·»åŠ ä¸€ä¸ª afterEach å¯¼èˆªå®ˆå«ã€‚è¿”å›ä¸€ä¸ªå¸è½½è¯¥å®ˆå«çš„å‡½æ•°ã€‚\r\n     */\r\n    afterEach(guard: NavigationGuard<TName>): () => void;\r\n    /**\r\n     * è®°å½•è·¯ç”±å…ƒä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªç”¨äºæ’¤é”€æ³¨å†Œçš„å‡½æ•°ã€‚\r\n     */\r\n    defineRoute(name: TName, meta: RouteMeta): () => void;\r\n    /**\r\n     * è·å–å¯¹åº”è·¯ç”±çš„å…ƒä¿¡æ¯ã€‚\r\n     */\r\n    getRouteMeta(name: TName): RouteMeta | undefined;\r\n    /**\r\n     * è·å–æ‰€æœ‰è·¯ç”±çš„å…ƒä¿¡æ¯å¿«ç…§ã€‚\r\n     */\r\n    listRouteMeta(): ReadonlyMap<TName, RouteMeta>;\r\n    /**\r\n     * æ‰‹åŠ¨æ‰§è¡Œ beforeEach å¯¼èˆªå®ˆå«é“¾ã€‚\r\n     * @returns è¿”å›å¯¼èˆªæ§åˆ¶ç»“æœ\r\n     */\r\n    runBeforeInterceptors(\r\n        to: RouteLocationNormalized<TName>,\r\n        from: RouteLocationNormalized<TName>\r\n    ): Promise<{ shouldContinue: boolean; redirectTo?: RouteLocationRaw<TName> }>;\r\n    /**\r\n     * æ‰‹åŠ¨æ‰§è¡Œ afterEach å¯¼èˆªå®ˆå«é“¾ã€‚\r\n     */\r\n    runAfterInterceptors(to: RouteLocationNormalized<TName>, from: RouteLocationNormalized<TName>): Promise<void>;\r\n    /**\r\n     * è®¾ç½®é¡µé¢ç¼“å­˜æ•°æ®(query å’Œ handler è¿”å›å€¼)\r\n     */\r\n    setPageCache(url: TName, data: { query: Record<string, any>; handlerResult?: unknown }): void;\r\n    /**\r\n     * è·å–é¡µé¢ç¼“å­˜æ•°æ®\r\n     */\r\n    getPageCache(url: TName): { query: Record<string, any>; handlerResult?: unknown } | undefined;\r\n    /**\r\n     * åˆ é™¤é¡µé¢ç¼“å­˜æ•°æ®\r\n     */\r\n    deletePageCache(url: TName): void;\r\n}\r\n\r\n/**\r\n * Router å¯¹å¤–æš´éœ²çš„å®Œæ•´æ¥å£ï¼ŒåªåŒ…å«å…¬å¼€çš„æ–¹æ³•ã€‚\r\n */\r\nexport interface Router<TName extends string> {\r\n    /**\r\n     * æ³¨å†Œä¸€ä¸ªè·¯ç”±å¤„ç†å‡½æ•°ã€‚è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…ï¼ˆå¸è½½ï¼‰å‡½æ•°ï¼Œç”¨äºç§»é™¤è¯¥å¤„ç†å‡½æ•°ã€‚\r\n     */\r\n    register(name: TName, handler: RouteHandler): () => void;\r\n    /**\r\n     * é€šè¿‡åç§°ç§»é™¤å·²æ³¨å†Œçš„å¤„ç†å‡½æ•°ã€‚è‹¥å­˜åœ¨åˆ™è¿”å› trueã€‚\r\n     */\r\n    unregister(name: TName): boolean;\r\n    /**\r\n     * æ£€æŸ¥æ˜¯å¦å·²ä¸ºç»™å®šåç§°æ³¨å†Œå¤„ç†å‡½æ•°ã€‚\r\n     */\r\n    has(name: TName): boolean;\r\n    /**\r\n     * æ·»åŠ ä¸€ä¸ª beforeEach å¯¼èˆªå®ˆå«ã€‚è¿”å›ä¸€ä¸ªå¸è½½è¯¥å®ˆå«çš„å‡½æ•°ã€‚\r\n     */\r\n    beforeEach(guard: NavigationGuard<TName>): () => void;\r\n    /**\r\n     * æ·»åŠ ä¸€ä¸ª afterEach å¯¼èˆªå®ˆå«ã€‚è¿”å›ä¸€ä¸ªå¸è½½è¯¥å®ˆå«çš„å‡½æ•°ã€‚\r\n     */\r\n    afterEach(guard: NavigationGuard<TName>): () => void;\r\n    /**\r\n     * ç”Ÿæˆç»‘å®šå½“å‰ Router å®ä¾‹çš„ useRouter é’©å­ã€‚\r\n     */\r\n    useRouter(): RouterHookResult<TName>;\r\n    /**\r\n     * ç”Ÿæˆç»‘å®šå½“å‰ Router å®ä¾‹çš„ useRoute é’©å­,è·å–å½“å‰é¡µé¢çš„è·¯ç”±ä¿¡æ¯ã€‚\r\n     */\r\n    useRoute(): RouteInfo<TName>;\r\n}\r\n\r\n/**\r\n * åˆ›å»ºä¸€ä¸ªè·¯ç”±å®ä¾‹ï¼Œæ³›å‹ TName è¡¨ç¤ºå…è®¸çš„è·¯ç”±åç§°ï¼ˆé€šå¸¸ä¸ºå­—ç¬¦ä¸²å­—é¢é‡è”åˆç±»å‹ï¼‰ã€‚\r\n */\r\nexport function createRouter<const TRoutes extends Record<string, RouteMeta>>(routes: PagesConfig): Router<Extract<keyof TRoutes, string>>;\r\nexport function createRouter<TName extends string>(routes?: PagesConfig): Router<TName>;\r\nexport function createRouter<TName extends string>(routes?: PagesConfig): Router<TName> {\r\n    // å­˜å‚¨è·¯ç”±å¤„ç†å‡½æ•°çš„æ˜ å°„è¡¨\r\n    const handlers = new Map<TName, RouteHandler>();\r\n    // beforeEach å¯¼èˆªå®ˆå«æ•°ç»„\r\n    const beforeInterceptors: NavigationGuard<TName>[] = [];\r\n    // afterEach å¯¼èˆªå®ˆå«æ•°ç»„\r\n    const afterInterceptors: NavigationGuard<TName>[] = [];\r\n    // è·¯ç”±å…ƒä¿¡æ¯æ˜ å°„è¡¨\r\n    const routeMeta = new Map<TName, RouteMeta>();\r\n    // é¡µé¢ç¼“å­˜: å­˜å‚¨ query å’Œ handler è¿”å›å€¼\r\n    const pageCache = new Map<TName, { query: Record<string, any>; handlerResult?: unknown }>();\r\n\r\n    // å¦‚æœæä¾›äº† pages.json é…ç½®,è§£æå¹¶æ³¨å†Œæ‰€æœ‰è·¯ç”±\r\n    if (routes) {\r\n        parseRoutesFromPagesJson(routes).forEach((meta, name) => {\r\n            routeMeta.set(name as TName, meta);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * æ·»åŠ å®ˆå«åˆ°æŒ‡å®šçš„å®ˆå«æ•°ç»„\r\n     * @param bucket å®ˆå«æ•°ç»„\r\n     * @param guard è¦æ·»åŠ çš„å®ˆå«å‡½æ•°\r\n     * @returns è¿”å›ä¸€ä¸ªå¸è½½å‡½æ•°,è°ƒç”¨åå¯ç§»é™¤è¯¥å®ˆå«\r\n     */\r\n    const addInterceptor = (bucket: NavigationGuard<TName>[], guard: NavigationGuard<TName>) => {\r\n        bucket.push(guard);\r\n        return () => {\r\n            const index = bucket.indexOf(guard);\r\n            if (index >= 0) bucket.splice(index, 1);\r\n        };\r\n    };\r\n    /**\r\n     * æ‰§è¡Œå¯¼èˆªå®ˆå«é“¾\r\n     * æŒ‰æ³¨å†Œé¡ºåºä¾æ¬¡æ‰§è¡Œå®ˆå«,ä»»ä½•å®ˆå«è¿”å› false æˆ–é‡å®šå‘åœ°å€éƒ½ä¼šä¸­æ–­åç»­å®ˆå«çš„æ‰§è¡Œ\r\n     * @param bucket å®ˆå«æ•°ç»„\r\n     * @param to ç›®æ ‡è·¯ç”±ä½ç½®\r\n     * @param from æ¥æºè·¯ç”±ä½ç½®\r\n     * @returns è¿”å›å¯¼èˆªæ§åˆ¶ç»“æœ\r\n     *   - shouldContinue: true è¡¨ç¤ºç»§ç»­å¯¼èˆª, false è¡¨ç¤ºå–æ¶ˆå¯¼èˆª\r\n     *   - redirectTo: å¦‚æœå­˜åœ¨,è¡¨ç¤ºé‡å®šå‘åˆ°è¯¥åœ°å€\r\n     */\r\n    const runInterceptors = async (\r\n        bucket: NavigationGuard<TName>[],\r\n        to: RouteLocationNormalized<TName>,\r\n        from: RouteLocationNormalized<TName>\r\n    ): Promise<{ shouldContinue: boolean; redirectTo?: RouteLocationRaw<TName> }> => {\r\n        for (const guard of bucket) {\r\n            // åœ¨å¾ªç¯ä¸­ await,ä»¥æ”¯æŒå¼‚æ­¥å®ˆå«çš„é¡ºåºæ‰§è¡Œ\r\n            // eslint-disable-next-line no-await-in-loop\r\n            const result = await guard(to, from);\r\n\r\n            // å¤„ç†å®ˆå«è¿”å›å€¼\r\n            if (result === false) {\r\n                // è¿”å› false å–æ¶ˆå¯¼èˆª\r\n                return { shouldContinue: false };\r\n            }\r\n\r\n            if (result && typeof result === 'object' && 'path' in result) {\r\n                // è¿”å›è·¯ç”±å¯¹è±¡é‡å®šå‘ { path: 'home', query: {...}, replace: true }\r\n                return { shouldContinue: false, redirectTo: result };\r\n            }\r\n\r\n            if (typeof result === 'string') {\r\n                // è¿”å›è·¯ç”±åç§°å­—ç¬¦ä¸²é‡å®šå‘\r\n                return { shouldContinue: false, redirectTo: result as TName };\r\n            }\r\n\r\n            // result ä¸º undefined æˆ– true,ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå®ˆå«\r\n        }\r\n\r\n        // æ‰€æœ‰å®ˆå«éƒ½é€šè¿‡,å…è®¸å¯¼èˆªç»§ç»­\r\n        return { shouldContinue: true };\r\n    };\r\n\r\n    /**\r\n     * æ‰§è¡Œ after å®ˆå«é“¾(ä¸æ”¯æŒå¯¼èˆªæ§åˆ¶,ä»…ç”¨äºé€šçŸ¥)\r\n     * after å®ˆå«åœ¨å¯¼èˆªå®Œæˆåæ‰§è¡Œ,æ— æ³•é˜»æ­¢æˆ–é‡å®šå‘å¯¼èˆª\r\n     * @param bucket å®ˆå«æ•°ç»„\r\n     * @param to ç›®æ ‡è·¯ç”±ä½ç½®\r\n     * @param from æ¥æºè·¯ç”±ä½ç½®\r\n     */\r\n    const runAfterInterceptors = async (\r\n        bucket: NavigationGuard<TName>[],\r\n        to: RouteLocationNormalized<TName>,\r\n        from: RouteLocationNormalized<TName>\r\n    ): Promise<void> => {\r\n        for (const guard of bucket) {\r\n            // æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰ after å®ˆå«\r\n            // eslint-disable-next-line no-await-in-loop\r\n            await guard(to, from);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // Router æ ¸å¿ƒå®ç°å¯¹è±¡,åŒ…å«æ‰€æœ‰å†…éƒ¨æ–¹æ³•\r\n    const routerImpl: RouterCore<TName> = {\r\n        // æ³¨å†Œè·¯ç”±å¤„ç†å‡½æ•°\r\n        register: (name, handler) => {\r\n            handlers.set(name, handler);\r\n            // è¿”å›å¸è½½å‡½æ•°\r\n            return () => {\r\n                handlers.delete(name);\r\n            };\r\n        },\r\n        // ç§»é™¤è·¯ç”±å¤„ç†å‡½æ•°\r\n        unregister: (name) => handlers.delete(name),\r\n        // æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œå¤„ç†å‡½æ•°\r\n        has: (name) => handlers.has(name),\r\n        // è·å–è·¯ç”±å¤„ç†å‡½æ•°\r\n        getHandler: (name) => handlers.get(name),\r\n        // æ·»åŠ  beforeEach å®ˆå«\r\n        beforeEach: (interceptor) => addInterceptor(beforeInterceptors, interceptor),\r\n        // æ·»åŠ  afterEach å®ˆå«\r\n        afterEach: (interceptor) => addInterceptor(afterInterceptors, interceptor),\r\n        // å®šä¹‰è·¯ç”±å…ƒä¿¡æ¯\r\n        defineRoute: (name, meta) => {\r\n            routeMeta.set(name, meta);\r\n            // è¿”å›æ’¤é”€å‡½æ•°\r\n            return () => {\r\n                routeMeta.delete(name);\r\n            };\r\n        },\r\n        // è·å–è·¯ç”±å…ƒä¿¡æ¯\r\n        getRouteMeta: (name) => routeMeta.get(name),\r\n        // è·å–æ‰€æœ‰è·¯ç”±å…ƒä¿¡æ¯çš„åªè¯»å¿«ç…§\r\n        listRouteMeta: () => new Map(routeMeta),\r\n        // æ‰§è¡Œ beforeEach å®ˆå«é“¾\r\n        runBeforeInterceptors: (to, from) => runInterceptors(beforeInterceptors, to, from),\r\n        // æ‰§è¡Œ afterEach å®ˆå«é“¾\r\n        runAfterInterceptors: (to, from) => runAfterInterceptors(afterInterceptors, to, from),\r\n        // é¡µé¢ç¼“å­˜ç®¡ç†æ–¹æ³•\r\n        setPageCache: (name, data) => pageCache.set(name, data),\r\n        getPageCache: (name) => pageCache.get(name),\r\n        deletePageCache: (name) => pageCache.delete(name),\r\n    };\r\n\r\n    // åˆ›å»º useRouter å·¥å‚å‡½æ•°,é—­åŒ…æŒæœ‰å®Œæ•´çš„ routerImpl\r\n    const useRouterFactory = () => createRouterHook(routerImpl);\r\n    // åˆ›å»º useRoute å·¥å‚å‡½æ•°,é—­åŒ…æŒæœ‰å®Œæ•´çš„ routerImpl\r\n    const useRouteFactory = () => createRouteHook(routerImpl);\r\n\r\n    // åªè¿”å›å…¬å¼€çš„æ–¹æ³•,éšè—å†…éƒ¨å®ç°ç»†èŠ‚\r\n    return {\r\n        afterEach: routerImpl.afterEach,        // æ³¨å†Œ afterEach å®ˆå«\r\n        beforeEach: routerImpl.beforeEach,      // æ³¨å†Œ beforeEach å®ˆå«\r\n        register: routerImpl.register,          // æ³¨å†Œè·¯ç”±å¤„ç†å‡½æ•°\r\n        unregister: routerImpl.unregister,      // ç§»é™¤è·¯ç”±å¤„ç†å‡½æ•°\r\n        has: routerImpl.has,                    // æ£€æŸ¥å¤„ç†å‡½æ•°æ˜¯å¦å­˜åœ¨\r\n        useRouter: useRouterFactory,            // åˆ›å»º useRouter é’©å­\r\n        useRoute: useRouteFactory               // åˆ›å»º useRoute é’©å­\r\n    } as Router<TName>;\r\n}\r\n","import { PagesConfig } from \"./pages\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport { extractSecondPathSegment } from \"./utils\";\r\n\r\n\r\n\r\n/**\r\n * ä» pages.json ä¸­æå–æ‰€æœ‰è·¯ç”±åç§°\r\n * @param pagesJson pages.json é…ç½®å¯¹è±¡\r\n * @returns è·¯ç”±åç§°çš„ Set é›†åˆ\r\n */\r\nfunction extractRouteNamesFromPages(pagesJson: PagesConfig): Set<string> {\r\n\tconst routes = new Set<string>();\r\n\r\n\t// å¤„ç†ä¸»åŒ…é¡µé¢\r\n\tif (pagesJson.pages) {\r\n\t\tpagesJson.pages.forEach(page => {\r\n\t\t\tconst name = extractSecondPathSegment(page.path);\r\n\t\t\tif (name) {\r\n\t\t\t\troutes.add(name);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// å¤„ç†åˆ†åŒ…é¡µé¢\r\n\tif (pagesJson.subPackages) {\r\n\t\tpagesJson.subPackages.forEach(subpackage => {\r\n\t\t\tconst root = subpackage.root;\r\n\t\t\tsubpackage.pages.forEach(page => {\r\n\t\t\t\tconst name = extractSecondPathSegment(`${root}/${page.path}`);\r\n\t\t\t\tif (name) {\r\n\t\t\t\t\troutes.add(name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn routes;\r\n}\r\n\r\n/**\r\n * ç”Ÿæˆè·¯ç”±ç±»å‹å®šä¹‰å­—ç¬¦ä¸²\r\n * @param routeNames è·¯ç”±åç§°æ•°ç»„\r\n * @returns TypeScript ç±»å‹å®šä¹‰å­—ç¬¦ä¸²\r\n */\r\nfunction generateTypeDefinition(routeNames: string[]): string {\r\n\tconst sortedRoutes = [...routeNames].sort((a, b) => a.localeCompare(b));\r\n\treturn `export type Path =\\n${sortedRoutes.map(name => `  | '${name}'`).join('\\n')}`;\r\n}\r\n\r\n/**\r\n * è¯»å–å¹¶è§£æ pages.json æ–‡ä»¶\r\n * @param pagesJsonPath pages.json æ–‡ä»¶è·¯å¾„\r\n * @returns è§£æåçš„é…ç½®å¯¹è±¡\r\n */\r\nfunction readPagesJson(pagesJsonPath: string): PagesConfig {\r\n\tconst content = fs.readFileSync(pagesJsonPath, 'utf8');\r\n\treturn JSON.parse(content);\r\n}\r\n\r\n/**\r\n * ç”Ÿæˆè·¯ç”±ç±»å‹æ–‡ä»¶\r\n * @param dts ç±»å‹æ–‡ä»¶è¾“å‡ºè·¯å¾„\r\n * @param pagesJsonPath pages.json æ–‡ä»¶è·¯å¾„\r\n */\r\nfunction generateRouteTypeFile(dts: string, pagesJsonPath: string): void {\r\n\tconst pagesJson = readPagesJson(pagesJsonPath);\r\n\tconst routeNames = extractRouteNamesFromPages(pagesJson);\r\n\tconst typeDefinition = generateTypeDefinition(Array.from(routeNames));\r\n\tfs.writeFileSync(dts, typeDefinition, 'utf8');\r\n}\r\n\r\n/**\r\n * Vite æ’ä»¶: è‡ªåŠ¨ç”Ÿæˆè·¯ç”±ç±»å‹å®šä¹‰\r\n * @param dts ç±»å‹æ–‡ä»¶è¾“å‡ºè·¯å¾„\r\n * @returns Vite æ’ä»¶å¯¹è±¡\r\n */\r\nexport function routeTypesPlugin(dts: string) {\r\n\tlet isFirstBuild = true;\r\n\r\n\treturn {\r\n\t\tname: 'route-types-generator',\r\n\t\t/**\r\n\t\t * æ„å»ºå¼€å§‹æ—¶ç”Ÿæˆè·¯ç”±ç±»å‹\r\n\t\t */\r\n\t\tbuildStart() {\r\n\t\t\t// åªåœ¨é¦–æ¬¡æ„å»ºæ—¶ç”Ÿæˆç±»å‹,é¿å…é‡å¤ç”Ÿæˆ\r\n\t\t\tif (isFirstBuild) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst pagesJsonPath = path.resolve(__dirname, '../src/pages.json');\r\n\t\t\t\t\tgenerateRouteTypeFile(dts, pagesJsonPath);\r\n\t\t\t\t\tisFirstBuild = false;\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconst message = error instanceof Error ? error.message : String(error);\r\n\t\t\t\t\tconsole.warn('è·¯ç”±ç±»å‹ç”Ÿæˆå¤±è´¥:', message);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * çƒ­æ›´æ–°æ—¶ç›‘å¬ pages.json å˜åŒ–\r\n\t\t */\r\n\t\thandleHotUpdate(ctx: any) {\r\n\t\t\t// ç›‘å¬ pages.json å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°ç”Ÿæˆç±»å‹\r\n\t\t\tif (ctx.file.endsWith('pages.json')) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst { generateRouteTypes } = require('./script/generate-route-types.js');\r\n\t\t\t\t\tgenerateRouteTypes();\r\n\t\t\t\t\tconsole.log('ğŸ”„ æ£€æµ‹åˆ° pages.json å˜åŒ–ï¼Œå·²è‡ªåŠ¨æ›´æ–°è·¯ç”±ç±»å‹');\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconst message = error instanceof Error ? error.message : String(error);\r\n\t\t\t\t\tconsole.warn('çƒ­æ›´æ–°æ—¶ç”Ÿæˆè·¯ç”±ç±»å‹å¤±è´¥:', message);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t};\r\n}\r\n\r\n"],"mappings":"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","names":["CloseTypes","path"]}